---
title: "Nowcasting"
author: "Rachel Mercaldo"
output: html_document
---

```{r cleanup packages data}
#clean the workspace up (if desired):
rm(list=ls())
graphics.off()

#get the package tvReg:
library(tvReg)
library(forecast)


#get the data saved from running through backcasting.Rmd:
load("data/forecasting_data.rdata")

```
\  

Below, I will be using tvAR(), as mentioned in the Google doc strategy. The vignette for the package is located [here](https://icasas.github.io/tvReg/articles/tvReg.html#standard-usage-of-tvar). 


```{r tvAR}
start <- as.Date(min(forecast$date)) + 1
end<-as.Date(start + 58)
xlims = as.Date(start:end, origin = "1970-01-01") #just setting up the axes for the plot
ts<-ts(forecast$curve[1:60], start = c(2019, 334),frequency = 365)
#use tvAR function on the first 60 rows of the forecast curve
mod.tvAR <- tvAR(ts, p = 1, type = "none", est="ll", tkernel = "Gaussian")

fit<-mod.tvAR$fitted

plot(x = xlims, y = fit, type = "l", col = "blue")
lines(x = xlims, forecast$curve[2:60], type = "l", col = "red")
legend("center", 
  legend = c("tvAR Fit", "Backcast"), 
  col = c("blue", 
  "red"), 
  pch = c(19,19))
```


Attempt at forecasting using tvReg::forecast on mod.tvAR object. 

```{r, eval = F}
forward<-tvReg::forecast(mod.tvAR, n.ahead = 10)

```

The tvReg forecast call gives an error. From my research, this is essentially because the process underlying the data is constant (there are no special trends, cycles or seasonality).
We can use a regular forcast from the package **forecast**:

Here is the forecast using the tvAR fitted values:

```{r}

forward<-forecast::forecast(mod.tvAR$fitted,10) #10 days forward
plot(forward, col = "blue",main = "Forecast of Infections")
lines(forecast$curve[2:60],col = "red")
legend("center", 
  legend = c("tvAR Fit and Forecast", "Backcast Curve"), 
  col = c("blue", 
  "red"), 
  pch = c(19,19))

```

Here is the forecast using the original backcasting curve:

```{r}
#ts<-ts(forecast$curve[1:60], start = c(2019, 334),frequency = 365) #just a repeat on how ts was formed above
forward<-forecast::forecast(ts,10)
plot(forward, main = "Forecast of Infections")
lines(forecast$curve[1:60])
```

I also will try a Holt Winters exponential smoothing.
Holt Winters apples a triple exponential smoothing for level, trend, and seasonal components. We effectively only have level (basically the expected value), so we will remove the "beta" and "gamma" order parameters in the code below.
Alpha will be estimated. 
```{r}
fitHW<-HoltWinters(ts,beta = FALSE, gamma = FALSE)
fitHW
plot(fitHW)

forwardHW<-forecast::forecast(fitHW,10)
plot(forwardHW)
```
\  

The alpha is nearly 1, this means the more recent values of our series are weighted more heavily than older values for the level smoothing, and have a greater effect. As we can also see, this forecast is mostly a straight line from the last value, so the HW smooth may be dealing with the same issues as the tvAR forecast that failed.
\  


#####Issues
The forecasts change with the amount of data used (switching from 58 to 59 to 60 rows has a dramatic effect). Since we should have more data now, the forecast will hopefully be improved. 

tvAR: At this point, we can't do any sort of forecasting with the tvReg package since our time series only has a level value, and no trend or seasonality. I am not sure if/how the tdar code would improve this: I don't have enough time to dig deeply into the tdar functions to try to understand the code without more comments on what the various parts are doing, what the imputs are, and what the outputs should look like.

\  

#####Bootstrapping, and general comment
It would be great to meet again and talk about bootstrapping/sampling the residuals, and other expectations for the project. Forecasting is not the hard part of this project and should be done fairly quickly, and I don't want to hold anyone back by not understanding what y'all are looking for. 