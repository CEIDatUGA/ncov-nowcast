---
title: "Nowcasting from fatalities"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    df_print: paged
---

<!-- Knit this page second -->

```{r setup, include=FALSE}

library(tidyverse)
library(tibbletime)
library(padr)
library(tvReg)
library(forecast)
source('R/nowcast.R')
# source('R/data.R')
```

<!-- Get fatalities reports for US states -->
```{r data, include=FALSE, message = FALSE, warning = FALSE, cache = FALSE}
fatalities.US <- readRDS('data/fatalities.US.rds')
```

<!-- Set params for US -->
```{r params, include=FALSE, message = FALSE, warning = FALSE, cache = FALSE}
params.US <- readRDS('data/params.US.rds')
```

<!-- calculate nowcast for US -->
```{r nowcasts, include=FALSE, echo=FALSE, message = FALSE, warning = FALSE, cache = FALSE}
fatalities.US.all <- fatalities.US %>% dplyr::select(Date, deaths = US)

US.nowcast <- nowcast_from_deaths_with_onset_to_death(deathreports = fatalities.US.all, params.US)
# saveRDS(US.nowcast,"data/US.nowcast.from.fatalities.rds")
```

```{r US, echo=FALSE, message = FALSE, warning = FALSE, cache = FALSE, out.width = '100%'}
plot_nowcast_from_death_reports(US.nowcast) %>% plotly::layout(showlegend=TRUE)
```

![](nowcast-legend-deaths.png)

### Parameters

**Infection fatality rate** = `r params.US$IFR`

**Symptom-onset-to-reporting interval:**  
Distribution: `r params.US$effective.infectious.period$dist`  
Mean = `r params.US$effective.infectious.period$mean`  
Shape = `r params.US$effective.infectious.period$shape`

**Incubation period:**  
Distribution: `r params.US$incubation.period$dist`  
Mean = `r params.US$incubation.period$mean`  
Shape = `r params.US$incubation.period$shape`

**Symmptom-onset-to-death interval:**  
Distribution: `r params.US$onset.to.death.period$dist`  
Mean = `r params.US$onset.to.death.period$mean`  
Shape = `r params.US$onset.to.death.period$shape`  